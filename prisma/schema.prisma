generator client {
  provider = "prisma-client-js"
  // previewFeatures = ["typedSql"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model cinemas {
  id        Int         @id @default(autoincrement())
  name      String      @unique(map: "sqlite_autoindex_cinemas_1")
  address   String?
  url       String
  schedules schedules[]
}

model movies {
  id            Int         @id @default(autoincrement())
  allocineId     String?     @unique
  allocineInternalId BigInt   @unique
  title         String
  originalTitle String?
  director      String
  cast          String?
  duration      Int?
  poster        String
  release       DateTime
  synopsis      String?     @db.Text
  genres        String
  allocineRaw   Json?
  schedules     schedules[]
}

model schedules {
  id       Int      @id @default(autoincrement())
  allocineInternalId BigInt?  @unique
  cinemaId Int
  movieId  Int
  showTime DateTime
  version  String
  movies   movies   @relation(fields: [movieId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  cinemas  cinemas  @relation(fields: [cinemaId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([showTime], map: "idx_schedules_showTime")
  @@unique([cinemaId, movieId, showTime, version])
}
